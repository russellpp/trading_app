import React, { useEffect, useState } from "react";
import styled from "styled-components";
import {
  formatBigNumber,
  formatChartData,
  formatPrice,
} from "../../utils/UtilityFunctions";
import CoinChart from "./CoinChart";
import { useDispatch, useSelector } from "react-redux";
import {
  selectChartData,
  selectCurrentCoin,
  selectMarketData,
} from "../../../redux/coinReducer";
import { clearLoading, setLoading } from "../../../redux/requestStatusReducer";

function CoinData() {
  const currentCoin = useSelector(selectCurrentCoin);
  const marketData = useSelector(selectMarketData)[0];
  const dispatch = useDispatch();
  const chartData = useSelector(selectChartData);
  const [priceData, setPriceData] = useState();
  const prices = [
    [1683009620211, 27992.06233407672],
    [1683009947505, 27998.250812134596],
    [1683010274391, 27988.507645262176],
    [1683010531256, 28002.239483655878],
    [1683010809331, 28005.574868351323],
    [1683011148384, 28016.22939194318],
    [1683011396659, 28022.217715071474],
    [1683011731093, 28056.104344667907],
    [1683012079805, 28063.824852097037],
    [1683012347254, 28113.807497221427],
    [1683012613819, 28097.81008609596],
    [1683012933181, 28076.204711228747],
    [1683013210481, 28068.17514887425],
    [1683013518389, 28070.369070742352],
    [1683013836646, 28045.37228174106],
    [1683014116883, 28030.141380509038],
    [1683014465400, 28057.4947607505],
    [1683014750120, 28056.537961392474],
    [1683014995587, 28078.893493295862],
    [1683015305665, 28088.029421770752],
    [1683015615439, 28130.686569995396],
    [1683015914026, 28119.18089705951],
    [1683016233909, 28100.16159899999],
    [1683016502126, 28105.98080249993],
    [1683016892410, 28076.879303878915],
    [1683017118566, 28068.16584250931],
    [1683017468153, 28057.791240500443],
    [1683017725352, 28043.644977077103],
    [1683018012760, 28050.28977424017],
    [1683018320199, 28037.787122323018],
    [1683018689263, 28036.40815513281],
    [1683018945355, 28040.648520029168],
    [1683019244713, 28056.035212422554],
    [1683019531648, 28025.97028441134],
    [1683019829182, 28014.49663560192],
    [1683020117128, 27960.923857902304],
    [1683020468496, 27978.262067188356],
    [1683020745222, 27990.255493865083],
    [1683020999833, 27979.017756905952],
    [1683021330337, 27978.287862603884],
    [1683021669367, 27996.19326596321],
    [1683021947108, 27990.993498093365],
    [1683022253094, 27984.607795709973],
    [1683022551038, 27992.42093632032],
    [1683022848615, 27988.626282574616],
    [1683023095268, 27989.54046742473],
    [1683023463644, 27989.800837800256],
    [1683023730073, 28013.191281309842],
    [1683024049684, 28019.329947176488],
    [1683024308376, 28021.885862250216],
    [1683024657005, 28036.08687431052],
    [1683024944916, 28024.76710826783],
    [1683025242503, 28025.561791089065],
    [1683025550870, 28024.42401497192],
    [1683025817312, 28033.006497928793],
    [1683026156369, 28044.73832734259],
    [1683026455939, 28038.641518446377],
    [1683026742488, 28073.304683819202],
    [1683027050735, 28076.704019923724],
    [1683027349861, 28076.40581907758],
    [1683027651904, 28067.303014798148],
    [1683027919660, 28067.098866304128],
    [1683028238711, 28067.723993947107],
    [1683028508355, 28044.015917526216],
    [1683028836455, 28073.41150317945],
    [1683029124540, 28066.46762311918],
    [1683029442175, 28052.03608446933],
    [1683029740095, 28054.93639722673],
    [1683030049816, 28058.54817678555],
    [1683030318536, 28046.650743994323],
    [1683030637179, 28045.076678758178],
    [1683030946632, 28054.538289003303],
    [1683031202590, 28100.99266112422],
    [1683031543052, 28139.37132475556],
    [1683031892798, 28151.37276694004],
    [1683032119958, 28163.199242190058],
    [1683032499371, 28125.1777894182],
    [1683032715017, 28141.710168523554],
    [1683033003304, 28123.268345541997],
    [1683033300275, 28096.932917959264],
    [1683033640990, 28078.957528018764],
    [1683033899192, 28090.00080579336],
    [1683034238171, 28079.767196524026],
    [1683034547425, 28093.515297580103],
    [1683034876943, 27991.221243857417],
    [1683035143375, 27972.052839767315],
    [1683035430920, 28008.44992498904],
    [1683035706419, 28011.987254151092],
    [1683036056608, 28017.43141227966],
    [1683036313392, 28017.412436407056],
    [1683036602033, 27992.011220595778],
    [1683036920054, 27997.891895015728],
    [1683037207789, 28127.171334296367],
    [1683037528413, 28242.83977407113],
    [1683037828585, 28431.676892253716],
    [1683038117001, 28501.38164195888],
    [1683038405267, 28538.200716097454],
    [1683038723863, 28578.06240893544],
    [1683039010351, 28530.53584944578],
    [1683039307019, 28470.55539908227],
    [1683039676641, 28355.133325158076],
    [1683039923708, 28302.975256611608],
    [1683040242307, 28328.578243165273],
    [1683040499380, 28387.604682559475],
    [1683040811419, 28427.561851588936],
    [1683041096941, 28444.31874908335],
    [1683041416944, 28401.215446613634],
    [1683041735502, 28447.74845090682],
    [1683042043959, 28515.316723326414],
    [1683042320438, 28679.409086338917],
    [1683042599450, 28647.00579526512],
    [1683042928161, 28528.537485217974],
    [1683043268136, 28544.106276095958],
    [1683043545529, 28527.023515254252],
    [1683043802986, 28583.164890989978],
    [1683044143157, 28543.05080212094],
    [1683044438718, 28532.39938055672],
    [1683044745884, 28541.7044806043],
    [1683045031841, 28570.269999844808],
    [1683045350965, 28549.659661473674],
    [1683045608260, 28542.215646936238],
    [1683045916842, 28528.34144059922],
    [1683046266817, 28511.923652387733],
    [1683046515511, 28487.49847827123],
    [1683046864726, 28482.582111875538],
    [1683047111506, 28491.864383517626],
    [1683047398981, 28518.253138648663],
    [1683047716797, 28508.9753847297],
    [1683048055786, 28508.343206833306],
    [1683048354637, 28480.237701917973],
    [1683048633196, 28510.76785577754],
    [1683048951593, 28494.469700661757],
    [1683049198458, 28521.49481897043],
    [1683049538227, 28511.73752288339],
    [1683049859096, 28547.47851615013],
    [1683050127262, 28599.969298825374],
    [1683050405289, 28555.829361464934],
    [1683050721980, 28560.992775932067],
    [1683051019075, 28627.242314075665],
    [1683051326416, 28657.93240662461],
    [1683051645724, 28639.993836051315],
    [1683051901442, 28637.659577449263],
    [1683052230802, 28645.56231781239],
    [1683052550176, 28603.895856317133],
    [1683052878430, 28712.06113243657],
    [1683053115352, 28668.606518859655],
    [1683053413459, 28699.740737449527],
    [1683053711428, 28725.894198521066],
    [1683053999932, 28695.29718609488],
    [1683054341918, 28684.625745878704],
    [1683054619127, 28829.254752801113],
    [1683054940467, 28881.8724142916],
    [1683055206743, 28818.82546489318],
    [1683055546624, 28821.830216096772],
    [1683055843880, 28845.735271380083],
    [1683056151977, 28784.83703159281],
    [1683056490735, 28833.02527173132],
    [1683056747033, 28776.641781157814],
    [1683057056664, 28757.208549518375],
    [1683057343476, 28748.042943001867],
    [1683057651713, 28748.16541120586],
    [1683057950173, 28750.190052928774],
    [1683058299278, 28722.667789876366],
    [1683058546240, 28694.922664477668],
    [1683058855874, 28658.779624063252],
    [1683059155237, 28723.72745902675],
    [1683059464214, 28731.39201984754],
    [1683059721891, 28747.404897718025],
    [1683060029558, 28758.10412816007],
    [1683060317013, 28760.434184746748],
    [1683060606553, 28728.366725979988],
    [1683060916355, 28706.92346797802],
    [1683061257312, 28699.043691450417],
    [1683061535266, 28688.751503046984],
    [1683061823953, 28672.590169676427],
    [1683062153871, 28683.048492564056],
    [1683062502387, 28673.065761612208],
    [1683062707539, 28675.898713124316],
    [1683063049074, 28674.33000705421],
    [1683063339200, 28656.64518944336],
    [1683063603756, 28715.290281490164],
    [1683063911995, 28674.970415785938],
    [1683064220591, 28659.056545228326],
    [1683064506667, 28675.05800276479],
    [1683064878618, 28663.786470664425],
    [1683065123786, 28681.84716153251],
    [1683065400958, 28746.895995474057],
    [1683065728930, 28725.188172946157],
    [1683066017082, 28719.76634089224],
    [1683066294474, 28744.023397234207],
    [1683066614889, 28766.516447176327],
    [1683066912715, 28759.061932908666],
    [1683067232261, 28761.82461578694],
    [1683067517651, 28807.912149795327],
    [1683067827222, 28809.403729832953],
    [1683068115278, 28777.605218075783],
    [1683068537414, 28759.555922195985],
    [1683068713678, 28762.97776303695],
    [1683069052701, 28768.412196400426],
    [1683069299446, 28737.20236802597],
    [1683069640479, 28731.067998694543],
    [1683069950063, 28728.09640749189],
    [1683070287595, 28697.45992743651],
    [1683070546981, 28693.60468577537],
    [1683070887411, 28664.87661150733],
    [1683071155212, 28661.14195860225],
    [1683071455519, 28658.306712803584],
    [1683071701445, 28654.390133326717],
    [1683072123252, 28700.842740700275],
    [1683072358870, 28663.002878149346],
    [1683072676108, 28699.753695476673],
    [1683072943963, 28656.471158720316],
    [1683073251657, 28668.677822444122],
    [1683073549358, 28650.750058886704],
    [1683073877752, 28659.779385693073],
    [1683074103358, 28642.36317805504],
    [1683074445662, 28612.11102909062],
    [1683074702160, 28623.664742955152],
    [1683075000121, 28616.44363941126],
    [1683075296722, 28619.059219824012],
    [1683075595283, 28537.034985428418],
    [1683075923195, 28584.436008892742],
    [1683076240395, 28532.75926649292],
    [1683076507971, 28554.287936394252],
    [1683076816735, 28546.295681282743],
    [1683077105525, 28539.412974621537],
    [1683077424066, 28525.911865173945],
    [1683077722819, 28543.224051703794],
    [1683078044248, 28553.660527840508],
    [1683078311131, 28560.39643626923],
    [1683078670294, 28539.252559185727],
    [1683078929282, 28542.667469803946],
    [1683079194064, 28513.804161889922],
    [1683079494180, 28533.625072880273],
    [1683079792335, 28467.472321366113],
    [1683080141237, 28476.950157991843],
    [1683080449452, 28479.83917133495],
    [1683080747487, 28432.702728098324],
    [1683081034130, 28461.94470225216],
    [1683081328402, 28504.000657851713],
    [1683081626952, 28499.858882205866],
    [1683081924007, 28491.253679211964],
    [1683082201581, 28498.766843448444],
    [1683082521881, 28503.960318560927],
    [1683082851181, 28522.6998550533],
    [1683083106176, 28514.43329374922],
    [1683083425709, 28515.75831447541],
    [1683083733501, 28514.937797458853],
    [1683084023328, 28492.44898919264],
    [1683084341157, 28497.776046624258],
    [1683084637555, 28535.11886915648],
    [1683084936622, 28509.966271427536],
    [1683085294502, 28496.4263721356],
    [1683085550983, 28553.387442606243],
    [1683085859774, 28530.55345308881],
    [1683086147105, 28531.103614134492],
    [1683086436121, 28529.460826282444],
    [1683086723882, 28506.715453159966],
    [1683087085930, 28512.326277742628],
    [1683087301218, 28508.10982714433],
    [1683087609857, 28514.285795296753],
    [1683087929610, 28511.209989651998],
    [1683088196580, 28518.769998488486],
    [1683088515644, 28530.36293876639],
    [1683088814617, 28523.515801873746],
    [1683089103419, 28513.136064896335],
    [1683089433734, 28511.476090114153],
    [1683089740642, 28503.927878833874],
    [1683090003590, 28526.836496395514],
    [1683090321367, 28525.08698989827],
    [1683090639790, 28531.918958668597],
    [1683090896536, 28531.36925272173],
    [1683091205640, 28516.514464283813],
    [1683091546006, 28491.886105398633],
    [1683091854787, 28477.700877689287],
    [1683092122850, 28485.689216709256],
    [1683092482636, 28481.853604408352],
    [1683092707544, 28489.06605275167],
    [1683093026892, 28489.245500215726],
    [1683093337575, 28480.278495073115],
    [1683093645882, 28486.16637858131],
    [1683093944871, 28476.217699419616],
    [1683094222108, 28465.541264228],
    [1683094539346, 28463.000613032924],
    [1683094887367, 28502.24325622234],
    [1683095145048, 28521.463040517447],
    [1683095484244, 28534.04096761942],
    [1683095751739, 28556.84076772529],
    [1683096060000, 28552.857921037703],
  ];

  useEffect(() => {
    const dataArray = chartData;

    if (dataArray) {
      dispatch(setLoading());
      setPriceData(formatChartData(dataArray));
      dispatch(clearLoading());
    } else {
      dispatch(setLoading());
      setPriceData(formatChartData(prices));
      dispatch(clearLoading());
    }
  }, [chartData]);

  return (
    <DataWrapper>
      <CoinPrice>
        <p>{marketData.id}</p>
        <p>{marketData.symbol}</p>
        <p>{formatPrice(marketData.current_price)}</p>
        <p>USD</p>
      </CoinPrice>
      <PriceChartWrapper>
        {priceData && <CoinChart data={priceData} />}
      </PriceChartWrapper>
      <CoinMiscData>
        <div>
          <p>Market Cap</p>
          <p>{formatBigNumber(marketData.market_cap)}</p>
        </div>
        <div>
          <p>{`High (24h)`}</p>
          <p>{formatPrice(marketData.high_24h)}</p>
        </div>
        <div>
          <p>{`Volume (24h)`}</p>
          <p>{formatBigNumber(marketData.total_volume)}</p>
        </div>
        <div>
          <p>{`Low (24h)`}</p>
          <p>{formatPrice(marketData.low_24h)}</p>
        </div>
        <button>add to watchlist</button>
      </CoinMiscData>
    </DataWrapper>
  );
}

const DataWrapper = styled.div`
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
`;

const CoinPrice = styled.div`
  box-sizing: border-box;
  padding: 10px 40px;
  display: flex;
  height: 15%;
  width: inherit;
  font-family: "RobotoMed";
  p {
    font-size: 15px;
    margin: 0;
    &:first-child {
      font-family: "Montserrat";
      color: var(--icterineDark);
      font-size: 40px;
      text-transform: uppercase;
      font-weight: 600;
    }
    &:nth-child(2) {
      margin-left: 10px;
      margin-top: 10px;
      font-family: "Montserrat";
      text-transform: uppercase;
      color: var(--navyLighter);
    }
    &:nth-child(3) {
      color: var(--icterine);
      margin-top: 10px;
      font-size: 35px;
      margin-left: auto;
    }
    &:nth-child(4) {
      color: var(--navyLighter);
      margin-left: 5px;
      margin-top: 27px;
      margin-right: 50px;
    }
  }
`;
const PriceChartWrapper = styled.div`
  height: 70%;
  width: inherit;
`;
const CoinMiscData = styled.div`
  box-sizing: border-box;
  padding: 0px 40px;
  display: grid;
  height: 15%;
  width: inherit;
  grid-template-areas:
    "a b e"
    "c d e";
  grid-template-columns: 30% 30% 40%;
  grid-template-rows: 1fr 1fr;
  color: var(--buffLighter);
  div {
    p {
      &:first-child {
        font-size: 10px;
        color: var(--navyLighter);
        text-transform: uppercase;
      }
      &:nth-child(2) {
        font-size: 18px;
      }
    }

    &:first-child {
      grid-area: a;
    }
    &:nith-child(2) {
      grid-area: b;
    }
    &:nith-child(3) {
      grid-area: c;
    }
    &:nith-child(4) {
      grid-area: d;
    }
  }
  button {
    grid-area: e;
  }
`;

export default CoinData;
